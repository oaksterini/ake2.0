<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Projektfiler</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      height: 100vh;
    }
    #sidebar {
      width: 30%;
      border-right: 1px solid #ddd;
      padding: 1rem;
      overflow-y: auto;
    }
    #viewer {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      white-space: pre-wrap;
      font-family: monospace;
    }
    .item {
      cursor: pointer;
      padding: 2px 4px;
    }
    .item:hover {
      color: blue;
    }
    .folder::before {
      content: "üìÅ ";
    }
    .file::before {
      content: "üìÑ ";
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <h2>Projektfiler</h2>
    <div id="fileTree"></div>
  </div>
  <div id="viewer"><i>Klicka p√• en fil f√∂r att visa inneh√•llet h√§r.</i></div>

  <script>
    // ---- KONFIG ----
    const CONFIG = {
      owner: "oaksterini",
      repo: "ake2.0",
      branch: "main"
    };

    const IGNORED = ["index.html", "CNAME"];

    async function fetchContents(path = "") {
      const url = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${path}?ref=${CONFIG.branch}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Kunde inte h√§mta " + path);
      return await res.json();
    }

    function createItem(entry, indent = 0) {
      const div = document.createElement("div");
      div.textContent = entry.name;
      div.classList.add("item");
      div.style.paddingLeft = (indent * 20) + "px";

      if (entry.type === "dir") {
        div.classList.add("folder");
        let expanded = false;
        let childrenContainer;

        div.addEventListener("click", async () => {
          if (expanded) {
            childrenContainer.remove();
            expanded = false;
          } else {
            try {
              const contents = await fetchContents(entry.path);
              childrenContainer = document.createElement("div");
              contents
                .filter(c => !IGNORED.includes(c.name))
                .forEach(c => {
                  childrenContainer.appendChild(createItem(c, indent + 1));
                });
              div.insertAdjacentElement("afterend", childrenContainer);
              expanded = true;
            } catch (e) {
              document.getElementById("viewer").textContent = "Fel: " + e.message;
            }
          }
        });
      } else if (entry.type === "file") {
        div.classList.add("file");
        div.addEventListener("click", async () => {
          try {
            const res = await fetch(entry.download_url);
            const text = await res.text();
            document.getElementById("viewer").textContent = text;
          } catch (e) {
            document.getElementById("viewer").textContent = "Fel: " + e.message;
          }
        });
      }
      return div;
    }

    async function buildTree() {
      try {
        const root = await fetchContents("");
        const tree = document.getElementById("fileTree");
        root
          .filter(e => !IGNORED.includes(e.name))
          .forEach(e => {
            tree.appendChild(createItem(e, 0));
          });
      } catch (e) {
        document.getElementById("viewer").textContent = "Fel: " + e.message;
      }
    }

    buildTree();
  </script>
</body>
</html>
